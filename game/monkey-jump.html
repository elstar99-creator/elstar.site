<!DOCTYPE html>
<html lang="en">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Monkey Jump ‚Äì Elstar</title>

<style>
    html, body {
        margin: 0;
        padding: 0;
        height: 100%;
        background: #cdeff6;
        font-family: system-ui;
        overflow: hidden;
    }

    #wrap {
        width: 100vw;
        height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        position: relative;
    }

    canvas {
        background: transparent;
    }

    .ui {
        position: absolute;
        top: 12px;
        left: 12px;
        color: #084;
        font-weight: 600;
        z-index: 5;
    }

    .hint {
        position: absolute;
        top: 12px;
        right: 12px;
        color: #055;
        opacity: 0.85;
        z-index: 5;
    }

    #startBtn {
        position: absolute;
        padding: 16px 34px;
        background: #00a884;
        border-radius: 14px;
        border: none;
        font-size: 22px;
        color: white;
        font-weight: 600;
        cursor: pointer;
        z-index: 10;
        display: block;
        box-shadow: 0 6px 18px rgba(0,0,0,0.2);
    }
</style>
</head>

<body>
<div id="wrap">
    <canvas id="game"></canvas>

    <div class="ui">Score: <span id="score">0</span></div>
    <div class="hint">Tap / Space to jump ‚Ä¢ R restart</div>

    <button id="startBtn">START GAME üêí</button>
</div>

<script>
/* ============================
      GAME SETUP
============================ */

const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

// ukuran asli game
const ORIGINAL_W = 900;
const ORIGINAL_H = 320;

let W = ORIGINAL_W;
let H = ORIGINAL_H;

/* SCALE RESPONSIVE */
function resizeGame() {
    const sw = window.innerWidth;
    const sh = window.innerHeight;

    const scale = Math.min(
        sw / ORIGINAL_W,
        sh / ORIGINAL_H
    );

    canvas.width = ORIGINAL_W;
    canvas.height = ORIGINAL_H;

    canvas.style.width = ORIGINAL_W * scale + "px";
    canvas.style.height = ORIGINAL_H * scale + "px";

    ctx.setTransform(scale, 0, 0, scale, 0, 0);
}
window.addEventListener("resize", resizeGame);
resizeGame();

/* ============================
        GAME VARIABLES
============================ */

let gravity = 0.9;
let gameSpeed = 4;
let spawnTimer = 0;
let score = 0;
let highScore = localStorage.getItem("monkey-high") || 0;
let running = false;

const groundY = ORIGINAL_H - 60;

/* Monkey */
const player = {
    x: 80,
    y: groundY - 90,
    w: 70,
    h: 90,
    vy: 0,
    grounded: true,
    jumpStrength: -17,

    draw() {
        ctx.save();
        ctx.translate(this.x, this.y);

        ctx.fillStyle = "#a0522d";
        roundRect(ctx, 10, 30, 50, 60, 10, true, false);

        ctx.beginPath(); 
        ctx.arc(35,20,22,0,Math.PI*2); 
        ctx.fill();

        ctx.fillStyle="#f3d6b6";
        ctx.beginPath(); 
        ctx.arc(35,22,15,0,Math.PI*2); 
        ctx.fill();

        ctx.fillStyle="#000";
        ctx.fillRect(27,15,5,5);
        ctx.fillRect(40,15,5,5);

        ctx.beginPath();
        ctx.arc(35,30,7,0,Math.PI);
        ctx.stroke();

        ctx.strokeStyle="#a0522d";
        ctx.lineWidth=5;
        ctx.beginPath();
        ctx.moveTo(0,40);
        ctx.quadraticCurveTo(-25,10,0,5);
        ctx.stroke();

        ctx.restore();
    }
};

/* Obstacles */
let obstacles = [];

function spawnObstacle() {
    const h = 40 + Math.random() * 20;
    obstacles.push({
        x: ORIGINAL_W + 40,
        w: 40,
        h: h,
        passed: false,
        draw() {
            ctx.fillStyle = "#6b4f2b";
            roundRect(ctx, this.x, groundY - this.h, this.w, this.h, 8, true, false);

            ctx.fillStyle = "#2e7d32";
            ctx.beginPath();
            ctx.ellipse(this.x+20, groundY-this.h-6, 32, 12, 0, 0, Math.PI*2);
            ctx.fill();

            ctx.fillStyle="#ffd54f";
            ctx.beginPath();
            ctx.arc(this.x+15, groundY-this.h-6, 5,0,Math.PI*2);
            ctx.fill();
        },
        update() {
            this.x -= gameSpeed;
        }
    });
}

/* Rounded rectangle helper */
function roundRect(ctx,x,y,w,h,r,fill,stroke){
  ctx.beginPath();
  ctx.moveTo(x+r,y);
  ctx.arcTo(x+w,y,x+w,y+h,r);
  ctx.arcTo(x+w,y+h,x,y+h,r);
  ctx.arcTo(x,y+h,x,y,r);
  ctx.arcTo(x,y,x+w,y,r);
  ctx.closePath();
  if(fill) ctx.fill();
  if(stroke) ctx.stroke();
}

/* JUMP */
function jump(){
    if(!running) return;
    if(player.grounded){
        player.vy = player.jumpStrength;
        player.grounded = false;
    }
}

/* INPUT */
document.addEventListener("keydown", (e)=>{
    if(e.code==="Space"){ jump(); e.preventDefault(); }
    if(e.key==="r") reset();
});
canvas.addEventListener("mousedown", jump);
canvas.addEventListener("touchstart", e=>{ e.preventDefault(); jump(); });

/* UPDATE LOOP */
function update() {
    if(!running) return;

    player.vy += gravity;
    player.y += player.vy;

    if(player.y + player.h >= groundY){
        player.y = groundY - player.h;
        player.vy = 0;
        player.grounded = true;
    }

    obstacles.forEach(o => o.update());
    if(obstacles.length && obstacles[0].x + obstacles[0].w < -50) obstacles.shift();

    spawnTimer--;
    if(spawnTimer <= 0){
        spawnObstacle();
        spawnTimer = 90 + Math.random()*70;
    }

    obstacles.forEach(o=>{
        if(!o.passed && o.x + o.w < player.x){
            o.passed = true;
            score += 10;
            document.getElementById("score").textContent = score;
        }
        if(collide(player,o)){
            running = false;
            endGame();
        }
    });
}

/* COLLISION */
function collide(p,o){
    return p.x < o.x+o.w && p.x+p.w > o.x &&
           p.y < groundY && p.y+p.h > groundY-o.h;
}

/* DRAW LOOP */
function draw(){
    ctx.clearRect(0,0,ORIGINAL_W,ORIGINAL_H);

    const g = ctx.createLinearGradient(0,0,0,ORIGINAL_H);
    g.addColorStop(0,"#cdeff6");
    g.addColorStop(1,"#e8f8ff");

    ctx.fillStyle=g;
    ctx.fillRect(0,0,ORIGINAL_W,ORIGINAL_H);

    ctx.fillStyle="#fff59d";
    ctx.beginPath();
    ctx.arc(ORIGINAL_W-80,60,30,0,Math.PI*2);
    ctx.fill();

    ctx.fillStyle="#7c5a2b";
    ctx.fillRect(0, groundY, ORIGINAL_W, 70);

    obstacles.forEach(o=>o.draw());
    player.draw();

    ctx.fillStyle="#045";
    ctx.font="16px system-ui";
    ctx.fillText("High: "+highScore, 16,22);
}

/* GAME LOOP */
function loop(){
    update();
    draw();
    if(running) requestAnimationFrame(loop);
}

/* GAME OVER */
function endGame(){
    ctx.fillStyle="rgba(0,0,0,0.35)";
    ctx.fillRect(0,0,ORIGINAL_W,ORIGINAL_H);

    ctx.fillStyle="#fff";
    ctx.textAlign="center";
    ctx.font="28px system-ui";
    ctx.fillText("Game Over", ORIGINAL_W/2, ORIGINAL_H/2 - 10);

    ctx.font="16px system-ui";
    ctx.fillText("Tap START untuk main lagi", ORIGINAL_W/2, ORIGINAL_H/2 + 18);

    if(score > highScore){
        highScore = score;
        localStorage.setItem("monkey-high", highScore);
    }

    startBtn.style.display = "block";
    startBtn.textContent = "PLAY AGAIN üêí";
}

/* RESET */
function reset(){
    obstacles = [];
    score = 0;
    document.getElementById("score").textContent = 0;

    player.y = groundY - player.h;
    player.vy = 0;

    running = true;
    spawnTimer = 50;
    loop();
}

/* START */
const startBtn = document.getElementById("startBtn");

startBtn.onclick = ()=>{
    obstacles = [];
    score = 0;

    player.y = groundY - player.h;
    player.vy = 0;

    running = true;
    spawnTimer = 40;

    startBtn.style.display = "none";
    document.getElementById("score").textContent = 0;

    loop();
};
</script>
</body>
  </html>
